<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ular Tangga Matematika</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            margin: 0;
            padding: 0;
            background-color: #f4f4f9;
        }
        canvas {
            border: 2px solid #333;
            margin-top: 20px;
            background-image: url('https://id.wikipedia.org/wiki/Ular_tangga#/media/Berkas:Ulartangga.JPG'); /* Background papan dari Wikipedia */
            background-size: cover;
            background-position: center;
        }
        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 10;
        }
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 5;
        }
        button {
            margin: 5px;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
        #dice-container {
            margin-top: 20px;
            font-size: 24px;
            font-weight: bold;
        }
        #dice-image {
            width: 100px;
            height: 100px;
            margin-top: 10px;
        }
        #rollButton {
            margin-top: 10px;
            padding: 10px 20px;
            font-size: 18px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        #rollButton:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #rollButton:hover {
            background-color: #0056b3;
        }
        #timer {
            font-size: 20px;
            font-weight: bold;
            margin-top: 10px;
        }
        #legend {
            margin-top: 20px;
            font-size: 16px;
        }
        .legend-item {
            display: inline-block;
            margin-right: 20px;
        }
        .legend-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
        }
    </style>
</head>
<body>
    <h1> Ular Tangga Matematika</h1>
    <canvas id="gameBoard" width="400" height="400"></canvas>
    <div id="dice-container">
        <button id="rollButton">Roll Dadu</button>
        <br>
        <img id="dice-image" src="" alt="Dadu">
    </div>
    <div class="popup" id="questionPopup">
        <p id="questionText">Soal: </p>
        <button id="option1" onclick="checkAnswer(0)">Pilihan 1</button>
        <button id="option2" onclick="checkAnswer(1)">Pilihan 2</button>
        <button id="option3" onclick="checkAnswer(2)">Pilihan 3</button>
        <div id="timer">Waktu tersisa: 5 detik</div>
    </div>
    <div class="overlay" id="overlay"></div>
    <div id="legend">
        <div class="legend-item">
            <span class="legend-color" style="background-color: red;"></span> Garis merah = Ular
        </div>
        <div class="legend-item">
            <span class="legend-color" style="background-color: black;"></span> Garis hitam = Tangga
        </div>
    </div>
    <script>
        const canvas = document.getElementById('gameBoard');
        const ctx = canvas.getContext('2d');
        const popup = document.getElementById('questionPopup');
        const overlay = document.getElementById('overlay');
        const questionText = document.getElementById('questionText');
        const diceImage = document.getElementById('dice-image');
        const rollButton = document.getElementById('rollButton');
        const timerElement = document.getElementById('timer');
        const gridSize = 10; // Ukuran papan 10x10
        const cellSize = canvas.width / gridSize;
        let playerPosition = 0;
        let currentQuestion = {};
        let diceRoll = 0;
        let timerInterval;
        const ladder = { 
            2: 23, 8: 14, 17: 36, 29: 45, 46: 30, 13: 77
        };
        const snake = { 
            48: 9, 54: 31, 62: 19, 
            15: 6, 32: 10, 49: 13, 60: 22,
            18: 4, 37: 20, 58: 40, 72: 63, 85: 70, 92: 80
        };
        const diceImages = [
            "https://upload.wikimedia.org/wikipedia/commons/2/2c/Alea_1.png",
            "https://upload.wikimedia.org/wikipedia/commons/b/b8/Alea_2.png",
            "https://upload.wikimedia.org/wikipedia/commons/2/2f/Alea_3.png",
            "https://upload.wikimedia.org/wikipedia/commons/8/8d/Alea_4.png",
            "https://upload.wikimedia.org/wikipedia/commons/5/55/Alea_5.png",
            "https://upload.wikimedia.org/wikipedia/commons/f/f4/Alea_6.png"
        ];

        function drawBoard() {
            for (let row = 0; row < gridSize; row++) {
                for (let col = 0; col < gridSize; col++) {
                    const x = col * cellSize;
                    const y = row * cellSize;
                    const cellNumber = gridSize * gridSize - (row * gridSize + col + 1);
                    ctx.strokeStyle = '#333';
                    ctx.strokeRect(x, y, cellSize, cellSize);
                    ctx.fillStyle = cellNumber % 2 === 0 ? '#90EE90' : '#ADD8E6'; // Hijau muda untuk genap, biru muda untuk ganjil
                    ctx.fillRect(x, y, cellSize, cellSize);
                    ctx.fillStyle = '#333';
                    ctx.font = '12px Arial';
                    ctx.fillText(cellNumber, x + 5, y + 15);
                }
            }
            drawLaddersAndSnakes();
        }

        function drawLaddersAndSnakes() {
            // Gambar tangga (garis hitam)
            Object.entries(ladder).forEach(([start, end]) => {
                const startCell = getCellCoordinates(start);
                const endCell = getCellCoordinates(end);
                ctx.beginPath();
                ctx.moveTo(startCell.x, startCell.y);
                ctx.lineTo(endCell.x, endCell.y);
                ctx.strokeStyle = 'black';
                ctx.lineWidth = 3;
                ctx.stroke();
            });
            // Gambar ular (garis merah)
            Object.entries(snake).forEach(([start, end]) => {
                const startCell = getCellCoordinates(start);
                const endCell = getCellCoordinates(end);
                ctx.beginPath();
                ctx.moveTo(startCell.x, startCell.y);
                ctx.lineTo(endCell.x, endCell.y);
                ctx.strokeStyle = 'red';
                ctx.lineWidth = 3;
                ctx.stroke();
            });
        }

        function getCellCoordinates(position) {
            const cellNumber = gridSize * gridSize - position;
            const row = Math.floor((cellNumber - 1) / gridSize);
            const col = (cellNumber - 1) % gridSize;
            return {
                x: col * cellSize + cellSize / 2,
                y: row * cellSize + cellSize / 2
            };
        }

        function drawPlayer(position) {
            const cellNumber = gridSize * gridSize - position;
            const row = Math.floor((cellNumber - 1) / gridSize);
            const col = (cellNumber - 1) % gridSize;
            const x = col * cellSize + cellSize / 2;
            const y = row * cellSize + cellSize / 2;
            ctx.beginPath();
            ctx.arc(x, y, 10, 0, Math.PI * 2);
            ctx.fillStyle = 'red';
            ctx.fill();
            ctx.closePath();
        }

        function rollDice() {
            return Math.floor(Math.random() * 6) + 1;
        }
        
        function generateQuestion() {
            const shapes = ['persegi', 'segitiga', 'persegiPanjang', 'lingkaran', 'jajarGenjang', 'trapesium', 'layangLayang'];
            const arithmeticOperations = ['+', '-', '*', '/'];
            const questionType = Math.random() < 0.25 ? 'geometry' : Math.random() < 0.50 ? 'arithmetic' : Math.random() < 0.75 ? 'physics' : 'volume';
        
            if (questionType === 'geometry') {
                return generateGeometryQuestion(shapes);
            } else if (questionType === 'arithmetic') {
                return generateArithmeticQuestion(arithmeticOperations);
            } else if (questionType === 'physics') {
                return generatePhysicsQuestion();
            } else {
                return generateVolumeQuestion();
            }
        }
        
        // Fungsi untuk menghasilkan soal geometri
        function generateGeometryQuestion(shapes) {
            const shape = shapes[Math.floor(Math.random() * shapes.length)];
            let question, correctAnswer;
        
            if (shape === 'persegi') {
                const sisi = Math.floor(Math.random() * 10) + 1;
                const luas = sisi * sisi;
                const askFor = Math.random() < 0.5 ? 'luas' : 'sisi';
                if (askFor === 'luas') {
                    question = Diketahui persegi memiliki sisi ${sisi} cm. Berapa luasnya?;
                    correctAnswer = luas;
                } else {
                    question = Diketahui luas persegi adalah ${luas} cm². Berapa panjang sisinya?;
                    correctAnswer = Math.sqrt(luas);
                }
            } else if (shape === 'segitiga') {
                const alas = Math.floor(Math.random() * 10) + 1;
                const tinggi = Math.floor(Math.random() * 10) + 1;
                const luas = (alas * tinggi) / 2;
                const askFor = Math.random() < 0.33 ? 'luas' : Math.random() < 0.5 ? 'alas' : 'tinggi';
                if (askFor === 'luas') {
                    question = Diketahui segitiga memiliki alas ${alas} cm dan tinggi ${tinggi} cm. Berapa luasnya?;
                    correctAnswer = luas;
                } else if (askFor === 'alas') {
                    question = Diketahui luas segitiga adalah ${luas} cm² dan tingginya ${tinggi} cm. Berapa panjang alasnya?;
                    correctAnswer = (2 * luas) / tinggi;
                } else {
                    question = Diketahui luas segitiga adalah ${luas} cm² dan alasnya ${alas} cm. Berapa tingginya?;
                    correctAnswer = (2 * luas) / alas;
                }
            } else if (shape === 'persegiPanjang') {
                const panjang = Math.floor(Math.random() * 10) + 1;
                const lebar = Math.floor(Math.random() * 10) + 1;
                const luas = panjang * lebar;
                const askFor = Math.random() < 0.33 ? 'luas' : Math.random() < 0.5 ? 'panjang' : 'lebar';
                if (askFor === 'luas') {
                    question = Diketahui persegi panjang memiliki panjang ${panjang} cm dan lebar ${lebar} cm. Berapa luasnya?;
                    correctAnswer = luas;
                } else if (askFor === 'panjang') {
                    question = Diketahui luas persegi panjang adalah ${luas} cm² dan lebarnya ${lebar} cm. Berapa panjangnya?;
                    correctAnswer = luas / lebar;
                } else {
                    question = Diketahui luas persegi panjang adalah ${luas} cm² dan panjangnya ${panjang} cm. Berapa lebarnya?;
                    correctAnswer = luas / panjang;
                }
            } else if (shape === 'lingkaran') {
                const radius = Math.floor(Math.random() * 10) + 1;
                const isMultipleOf7 = radius % 7 === 0; // Cek apakah jari-jari kelipatan 7
                const pi = isMultipleOf7 ? 22 / 7 : 3.14;
                const luas = pi * radius * radius;
                const askFor = Math.random() < 0.5 ? 'luas' : 'radius';
                if (askFor === 'luas') {
                    question = Diketahui lingkaran memiliki jari-jari ${radius} cm. Berapa luasnya? (Gunakan π = ${isMultipleOf7 ? '22/7' : '3.14'});
                    correctAnswer = parseFloat(luas.toFixed(2));
                } else {
                    question = Diketahui luas lingkaran adalah ${parseFloat(luas.toFixed(2))} cm². Berapa jari-jarinya? (Gunakan π = ${isMultipleOf7 ? '22/7' : '3.14'});
                    correctAnswer = parseFloat((Math.sqrt(luas / pi)).toFixed(2));
                }
            } else if (shape === 'jajarGenjang') {
                const alas = Math.floor(Math.random() * 10) + 1;
                const tinggi = Math.floor(Math.random() * 10) + 1;
                const luas = alas * tinggi;
                const askFor = Math.random() < 0.33 ? 'luas' : Math.random() < 0.5 ? 'alas' : 'tinggi';
                if (askFor === 'luas') {
                    question = Diketahui jajar genjang memiliki alas ${alas} cm dan tinggi ${tinggi} cm. Berapa luasnya?;
                    correctAnswer = luas;
                } else if (askFor === 'alas') {
                    question = Diketahui luas jajar genjang adalah ${luas} cm² dan tingginya ${tinggi} cm. Berapa panjang alasnya?;
                    correctAnswer = luas / tinggi;
                } else {
                    question = Diketahui luas jajar genjang adalah ${luas} cm² dan alasnya ${alas} cm. Berapa tingginya?;
                    correctAnswer = luas / alas;
                }
            } else if (shape === 'trapesium') {
                const a = Math.floor(Math.random() * 10) + 1;
                const b = Math.floor(Math.random() * 10) + 1;
                const tinggi = Math.floor(Math.random() * 10) + 1;
                const luas = ((a + b) * tinggi) / 2;
                const askFor = Math.random() < 0.25 ? 'luas' : Math.random() < 0.5 ? 'a' : Math.random() < 0.75 ? 'b' : 'tinggi';
                if (askFor === 'luas') {
                    question = Diketahui trapesium memiliki sisi sejajar ${a} cm dan ${b} cm serta tinggi ${tinggi} cm. Berapa luasnya?;
                    correctAnswer = luas;
                } else if (askFor === 'a') {
                    question = Diketahui luas trapesium adalah ${luas} cm², sisi sejajar kedua ${b} cm, dan tinggi ${tinggi} cm. Berapa panjang sisi sejajar pertama?;
                    correctAnswer = ((2 * luas) / tinggi - b);
                } else if (askFor === 'b') {
                    question = Diketahui luas trapesium adalah ${luas} cm², sisi sejajar pertama ${a} cm, dan tinggi ${tinggi} cm. Berapa panjang sisi sejajar kedua?;
                    correctAnswer = ((2 * luas) / tinggi - a);
                } else {
                    question = Diketahui luas trapesium adalah ${luas} cm², sisi sejajar ${a} cm dan ${b} cm. Berapa tingginya?;
                    correctAnswer = ((2 * luas) / (a + b));
                }
            } else if (shape === 'layangLayang') {
                const diagonal1 = Math.floor(Math.random() * 10) + 1;
                const diagonal2 = Math.floor(Math.random() * 10) + 1;
                const luas = (diagonal1 * diagonal2) / 2;
                const askFor = Math.random() < 0.33 ? 'luas' : Math.random() < 0.5 ? 'diagonal1' : 'diagonal2';
                if (askFor === 'luas') {
                    question = Diketahui layang-layang memiliki diagonal ${diagonal1} cm dan ${diagonal2} cm. Berapa luasnya?;
                    correctAnswer = luas;
                } else if (askFor === 'diagonal1') {
                    question = Diketahui luas layang-layang adalah ${luas} cm² dan diagonal kedua ${diagonal2} cm. Berapa panjang diagonal pertama?;
                    correctAnswer = (2 * luas) / diagonal2;
                } else {
                    question = Diketahui luas layang-layang adalah ${luas} cm² dan diagonal pertama ${diagonal1} cm. Berapa panjang diagonal kedua?;
                    correctAnswer = (2 * luas) / diagonal1;
                }
            }
        
            // Generate pilihan jawaban
            const options = [correctAnswer];
            while (options.length < 3) {
                let randomAnswer = Math.floor(Math.random() * 100) + 1;
                if (!options.includes(randomAnswer)) {
                    options.push(randomAnswer);
                }
            }
            options.sort(() => Math.random() - 0.5);
        
            return {
                question,
                options,
                answer: correctAnswer
            };
        }
        
        // Fungsi untuk menghasilkan soal aritmatika dengan bilangan negatif dan positif
        function generateArithmeticQuestion(arithmeticOperations) {
            const operation = arithmeticOperations[Math.floor(Math.random() * arithmeticOperations.length)];
            let num1, num2, correctAnswer;
        
            num1 = Math.floor(Math.random() * 200) - 100; // Rentang: -100 hingga 99
            num2 = Math.floor(Math.random() * 200) - 100; // Rentang: -100 hingga 99
        
            if (operation === '+') {
                correctAnswer = num1 + num2;
                question = Berapa hasil dari ${num1} + ${num2}?;
            } else if (operation === '-') {
                correctAnswer = num1 - num2;
                question = Berapa hasil dari ${num1} - ${num2}?;
            } else if (operation === '*') {
                correctAnswer = num1 * num2;
                question = Berapa hasil dari ${num1} × ${num2}?;
            } else if (operation === '/') {
                num2 = Math.floor(Math.random() * 50) + 1; // Pembagi antara 1 dan 50
                correctAnswer = Math.floor(Math.random() * 50) - 25; // Hasil pembagian antara -25 dan 24
                num1 = num2 * correctAnswer; // Pastikan pembagian bulat
                question = Berapa hasil dari ${num1} ÷ ${num2}?;
            }
        
            // Generate pilihan jawaban
            const options = [correctAnswer];
            while (options.length < 3) {
                let randomAnswer = Math.floor(Math.random() * 400) - 200; // Jawaban salah antara -200 dan 199
                if (!options.includes(randomAnswer)) {
                    options.push(randomAnswer);
                }
            }
            options.sort(() => Math.random() - 0.5);
        
            return {
                question,
                options,
                answer: correctAnswer
            };
        }
        
        // Fungsi untuk menghasilkan soal fisika (kecepatan dan debit)
        function generatePhysicsQuestion() {
            const physicsType = Math.random() < 0.5 ? 'speed' : 'flowRate';
            let question, correctAnswer;
        
            if (physicsType === 'speed') {
                // Pastikan jarak dan waktu menghasilkan kecepatan bulat
                const time = Math.floor(Math.random() * 50) + 1; // Waktu antara 1 dan 50 jam
                const speed = Math.floor(Math.random() * 50) + 1; // Kecepatan antara 1 dan 50 km/jam
                const distance = speed * time; // Jarak selalu bulat karena speed dan time bulat
        
                const askFor = Math.random() < 0.33 ? 'speed' : Math.random() < 0.5 ? 'distance' : 'time';
                if (askFor === 'speed') {
                    question = Sebuah mobil menempuh jarak ${distance} km dalam waktu ${time} jam. Berapa kecepatannya (km/jam)?;
                    correctAnswer = speed;
                } else if (askFor === 'distance') {
                    question = Sebuah mobil melaju dengan kecepatan ${speed} km/jam selama ${time} jam. Berapa jarak yang ditempuh (km)?;
                    correctAnswer = distance;
                } else {
                    question = Sebuah mobil menempuh jarak ${distance} km dengan kecepatan ${speed} km/jam. Berapa waktu yang dibutuhkan (jam)?;
                    correctAnswer = time;
                }
            } else if (physicsType === 'flowRate') {
                // Pastikan volume dan waktu menghasilkan debit bulat
                const time = Math.floor(Math.random() * 50) + 1; // Waktu antara 1 dan 50 menit
                const flowRate = Math.floor(Math.random() * 50) + 1; // Debit antara 1 dan 50 liter/menit
                const volume = flowRate * time; // Volume selalu bulat karena flowRate dan time bulat
        
                const askFor = Math.random() < 0.33 ? 'flowRate' : Math.random() < 0.5 ? 'volume' : 'time';
                if (askFor === 'flowRate') {
                    question = Sebuah pipa mengalirkan air sebanyak ${volume} liter dalam waktu ${time} menit. Berapa debit aliran airnya (liter/menit)?;
                    correctAnswer = flowRate;
                } else if (askFor === 'volume') {
                    question = Sebuah pipa memiliki debit aliran air ${flowRate} liter/menit. Jika air mengalir selama ${time} menit, berapa volume air yang dialirkan (liter)?;
                    correctAnswer = volume;
                } else {
                    question = Sebuah pipa memiliki debit aliran air ${flowRate} liter/menit. Jika volume air yang dialirkan adalah ${volume} liter, berapa waktu yang dibutuhkan (menit)?;
                    correctAnswer = time;
                }
            }
        
            // Generate pilihan jawaban
            const options = [correctAnswer];
            while (options.length < 3) {
                let randomAnswer = Math.floor(Math.random() * 100) + 1; // Jawaban salah antara 1 dan 100
                if (!options.includes(randomAnswer)) {
                    options.push(randomAnswer);
                }
            }
            options.sort(() => Math.random() - 0.5);
        
            return {
                question,
                options,
                answer: correctAnswer
            };
        }
        
        // Fungsi untuk menghasilkan soal volume bangun ruang
        function generateVolumeQuestion() {
            const shapes = ['balok', 'kubus', 'tabung', 'kerucut', 'prisma', 'limas'];
            const shape = shapes[Math.floor(Math.random() * shapes.length)];
            let question, correctAnswer;
        
            if (shape === 'balok') {
                const panjang = Math.floor(Math.random() * 10) + 1;
                const lebar = Math.floor(Math.random() * 10) + 1;
                const tinggi = Math.floor(Math.random() * 10) + 1;
                const volume = panjang * lebar * tinggi;
                const askFor = Math.random() < 0.33 ? 'volume' : Math.random() < 0.5 ? 'panjang' : Math.random() < 0.75 ? 'lebar' : 'tinggi';
                if (askFor === 'volume') {
                    question = Diketahui balok memiliki panjang ${panjang} cm, lebar ${lebar} cm, dan tinggi ${tinggi} cm. Berapa volumenya?;
                    correctAnswer = volume;
                } else if (askFor === 'panjang') {
                    question = Diketahui volume balok adalah ${volume} cm³, lebarnya ${lebar} cm, dan tingginya ${tinggi} cm. Berapa panjangnya?;
                    correctAnswer = volume / (lebar * tinggi);
                } else if (askFor === 'lebar') {
                    question = Diketahui volume balok adalah ${volume} cm³, panjangnya ${panjang} cm, dan tingginya ${tinggi} cm. Berapa lebarnya?;
                    correctAnswer = volume / (panjang * tinggi);
                } else {
                    question = Diketahui volume balok adalah ${volume} cm³, panjangnya ${panjang} cm, dan lebarnya ${lebar} cm. Berapa tingginya?;
                    correctAnswer = volume / (panjang * lebar);
                }
            } else if (shape === 'kubus') {
                const sisi = Math.floor(Math.random() * 10) + 1;
                const volume = sisi * sisi * sisi;
                const askFor = Math.random() < 0.5 ? 'volume' : 'sisi';
                if (askFor === 'volume') {
                    question = Diketahui kubus memiliki sisi ${sisi} cm. Berapa volumenya?;
                    correctAnswer = volume;
                } else {
                    question = Diketahui volume kubus adalah ${volume} cm³. Berapa panjang sisinya?;
                    correctAnswer = Math.cbrt(volume);
                }
            } else if (shape === 'tabung') {
                const radius = Math.floor(Math.random() * 10) + 1;
                const tinggi = Math.floor(Math.random() * 10) + 1;
                const isMultipleOf7 = radius % 7 === 0; // Cek apakah jari-jari kelipatan 7
                const pi = isMultipleOf7 ? 22 / 7 : 3.14;
                const volume = pi * radius * radius * tinggi;
                const askFor = Math.random() < 0.33 ? 'volume' : Math.random() < 0.5 ? 'radius' : 'tinggi';
                if (askFor === 'volume') {
                    question = Diketahui tabung memiliki jari-jari ${radius} cm dan tinggi ${tinggi} cm. Berapa volumenya? (Gunakan π = ${isMultipleOf7 ? '22/7' : '3.14'});
                    correctAnswer = parseFloat(volume.toFixed(2));
                } else if (askFor === 'radius') {
                    question = Diketahui volume tabung adalah ${parseFloat(volume.toFixed(2))} cm³ dan tingginya ${tinggi} cm. Berapa jari-jarinya? (Gunakan π = ${isMultipleOf7 ? '22/7' : '3.14'});
                    correctAnswer = parseFloat(Math.sqrt(volume / (pi * tinggi)).toFixed(2));
                } else {
                    question = Diketahui volume tabung adalah ${parseFloat(volume.toFixed(2))} cm³ dan jari-jarinya ${radius} cm. Berapa tingginya? (Gunakan π = ${isMultipleOf7 ? '22/7' : '3.14'});
                    correctAnswer = parseFloat((volume / (pi * radius * radius)).toFixed(2));
                }
            } else if (shape === 'kerucut') {
                const radius = Math.floor(Math.random() * 10) + 1;
                const tinggi = Math.floor(Math.random() * 10) + 1;
                const isMultipleOf7 = radius % 7 === 0; // Cek apakah jari-jari kelipatan 7
                const pi = isMultipleOf7 ? 22 / 7 : 3.14;
                const volume = (1 / 3) * pi * radius * radius * tinggi;
                const askFor = Math.random() < 0.33 ? 'volume' : Math.random() < 0.5 ? 'radius' : 'tinggi';
                if (askFor === 'volume') {
                    question = Diketahui kerucut memiliki jari-jari ${radius} cm dan tinggi ${tinggi} cm. Berapa volumenya? (Gunakan π = ${isMultipleOf7 ? '22/7' : '3.14'});
                    correctAnswer = parseFloat(volume.toFixed(2));
                } else if (askFor === 'radius') {
                    question = Diketahui volume kerucut adalah ${parseFloat(volume.toFixed(2))} cm³ dan tingginya ${tinggi} cm. Berapa jari-jarinya? (Gunakan π = ${isMultipleOf7 ? '22/7' : '3.14'});
                    correctAnswer = parseFloat(Math.sqrt((3 * volume) / (pi * tinggi)).toFixed(2));
                } else {
                    question = Diketahui volume kerucut adalah ${parseFloat(volume.toFixed(2))} cm³ dan jari-jarinya ${radius} cm. Berapa tingginya? (Gunakan π = ${isMultipleOf7 ? '22/7' : '3.14'});
                    correctAnswer = parseFloat((3 * volume / (pi * radius * radius)).toFixed(2));
                }
            } else if (shape === 'prisma') {
                const alas = Math.floor(Math.random() * 10) + 1;
                const tinggiAlas = Math.floor(Math.random() * 10) + 1;
                const tinggiPrisma = Math.floor(Math.random() * 10) + 1;
                const luasAlas = (alas * tinggiAlas) / 2; // Luas segitiga sebagai alas
                const volume = luasAlas * tinggiPrisma;
                const askFor = Math.random() < 0.33 ? 'volume' : Math.random() < 0.5 ? 'alas' : Math.random() < 0.75 ? 'tinggiAlas' : 'tinggiPrisma';
                if (askFor === 'volume') {
                    question = Diketahui prisma memiliki alas segitiga dengan panjang alas ${alas} cm, tinggi alas ${tinggiAlas} cm, dan tinggi prisma ${tinggiPrisma} cm. Berapa volumenya?;
                    correctAnswer = volume;
                } else if (askFor === 'alas') {
                    question = Diketahui volume prisma adalah ${volume} cm³, tinggi alasnya ${tinggiAlas} cm, dan tinggi prisma ${tinggiPrisma} cm. Berapa panjang alas segitiganya?;
                    correctAnswer = (2 * volume) / (tinggiAlas * tinggiPrisma);
                } else if (askFor === 'tinggiAlas') {
                    question = Diketahui volume prisma adalah ${volume} cm³, panjang alasnya ${alas} cm, dan tinggi prisma ${tinggiPrisma} cm. Berapa tinggi alas segitiganya?;
                    correctAnswer = (2 * volume) / (alas * tinggiPrisma);
                } else {
                    question = Diketahui volume prisma adalah ${volume} cm³, panjang alasnya ${alas} cm, dan tinggi alasnya ${tinggiAlas} cm. Berapa tinggi prisma?;
                    correctAnswer = volume / ((alas * tinggiAlas) / 2);
                }
            } else if (shape === 'limas') {
                const alas = Math.floor(Math.random() * 10) + 1;
                const tinggiAlas = Math.floor(Math.random() * 10) + 1;
                const tinggiLimas = Math.floor(Math.random() * 10) + 1;
                const luasAlas = (alas * tinggiAlas) / 2; // Luas segitiga sebagai alas
                const volume = (1 / 3) * luasAlas * tinggiLimas;
                const askFor = Math.random() < 0.33 ? 'volume' : Math.random() < 0.5 ? 'alas' : Math.random() < 0.75 ? 'tinggiAlas' : 'tinggiLimas';
                if (askFor === 'volume') {
                    question = Diketahui limas memiliki alas segitiga dengan panjang alas ${alas} cm, tinggi alas ${tinggiAlas} cm, dan tinggi limas ${tinggiLimas} cm. Berapa volumenya?;
                    correctAnswer = parseFloat(volume.toFixed(2));
                } else if (askFor === 'alas') {
                    question = Diketahui volume limas adalah ${parseFloat(volume.toFixed(2))} cm³, tinggi alasnya ${tinggiAlas} cm, dan tinggi limas ${tinggiLimas} cm. Berapa panjang alas segitiganya?;
                    correctAnswer = parseFloat(((6 * volume) / (tinggiAlas * tinggiLimas)).toFixed(2));
                } else if (askFor === 'tinggiAlas') {
                    question = Diketahui volume limas adalah ${parseFloat(volume.toFixed(2))} cm³, panjang alasnya ${alas} cm, dan tinggi limas ${tinggiLimas} cm. Berapa tinggi alas segitiganya?;
                    correctAnswer = parseFloat(((6 * volume) / (alas * tinggiLimas)).toFixed(2));
                } else {
                    question = Diketahui volume limas adalah ${parseFloat(volume.toFixed(2))} cm³, panjang alasnya ${alas} cm, dan tinggi alasnya ${tinggiAlas} cm. Berapa tinggi limas?;
                    correctAnswer = parseFloat(((3 * volume) / ((alas * tinggiAlas) / 2)).toFixed(2));
                }
            }
        
            // Generate pilihan jawaban
            const options = [correctAnswer];
            while (options.length < 3) {
                let randomAnswer = Math.floor(Math.random() * 100) + 1;
                if (!options.includes(randomAnswer)) {
                    options.push(randomAnswer);
                }
            }
            options.sort(() => Math.random() - 0.5);
        
            return {
                question,
                options,
                answer: correctAnswer
            };
        }
         
        function showQuestion() {
            currentQuestion = generateQuestion();
            questionText.textContent = Soal: ${currentQuestion.question};
            document.getElementById('option1').textContent = currentQuestion.options[0];
            document.getElementById('option2').textContent = currentQuestion.options[1];
            document.getElementById('option3').textContent = currentQuestion.options[2];
            popup.style.display = 'block';
            overlay.style.display = 'block';
            let timeLeft = 240;
            timerElement.textContent = Waktu tersisa: ${timeLeft} detik;
            timerInterval = setInterval(() => {
                timeLeft--;
                timerElement.textContent = Waktu tersisa: ${timeLeft} detik;
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    handleTimeout();
                }
            }, 1000);
        }

        function checkAnswer(selectedIndex) {
            clearInterval(timerInterval);
            const selectedAnswer = currentQuestion.options[selectedIndex];
            if (selectedAnswer === currentQuestion.answer) {
                alert('Jawaban Benar!');
                animatePlayerMovement(playerPosition, playerPosition + diceRoll);
            } else {
                alert('Jawaban Salah! Anda mundur sebanyak ' + diceRoll + ' langkah.');
                animatePlayerMovement(playerPosition, playerPosition - diceRoll);
            }
            popup.style.display = 'none';
            overlay.style.display = 'none';
            disableRollButtonFor5Seconds();
        }

        function handleTimeout() {
            alert('Waktu habis! Anda mendapat penalti mundur sebanyak ' + diceRoll + ' langkah.');
            animatePlayerMovement(playerPosition, playerPosition - diceRoll);
            popup.style.display = 'none';
            overlay.style.display = 'none';
            disableRollButtonFor5Seconds();
        }

        function animatePlayerMovement(startPosition, endPosition) {
            const steps = Math.abs(endPosition - startPosition);
            const direction = endPosition > startPosition ? 1 : -1;
            let currentStep = 0;

            const interval = setInterval(() => {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                drawBoard();

                const newPosition = startPosition + currentStep * direction;
                drawPlayer(newPosition);

                currentStep++;
                if (currentStep > steps) {
                    clearInterval(interval);
                    playerPosition = endPosition;
                    if (playerPosition < 0) playerPosition = 0;

                    if (playerPosition >= gridSize * gridSize) {
                        playerPosition = gridSize * gridSize - 1;
                        alert('Selamat! Anda menang!');
                        resetGame();
                        return;
                    }

                    if (ladder[playerPosition]) {
                        alert('Tangga ditemukan! Naik ke posisi ' + ladder[playerPosition]);
                        animatePlayerMovement(playerPosition, ladder[playerPosition]);
                    } else if (snake[playerPosition]) {
                        alert(' Digigit Ularrrrrr! Maaf Anda Turun ke posisi ' + snake[playerPosition]);
                        animatePlayerMovement(playerPosition, snake[playerPosition]);
                    }
                }
            }, 200); // Animasi bergerak setiap 200ms
        }

        function resetGame() {
            playerPosition = 0;
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawBoard();
            drawPlayer(playerPosition);
        }

        function disableRollButtonFor5Seconds() {
            rollButton.disabled = true;
            setTimeout(() => {
                rollButton.disabled = false;
            }, 2000); // Nonaktifkan tombol selama 5 detik
        }

        rollButton.addEventListener('click', () => {
            diceRoll = rollDice();
            diceImage.src = diceImages[diceRoll - 1]; // Update gambar dadu
            alert(Anda melempar dadu dan mendapatkan angka ${diceRoll});
            showQuestion();
        });

        drawBoard();
        drawPlayer(playerPosition);
    </script>
</body>
</html>
